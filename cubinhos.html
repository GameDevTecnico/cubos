<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <meta name="generator" content="Doxygen 1.8.17" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CUBOS.: Cubinhos</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
</head>
<body>
    <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
            <table cellspacing="0" cellpadding="0">
                <tbody>
                    <tr style="height: 56px;">
                        <td id="projectalign" style="padding-left: 0.5em;">
                            <div id="projectname">CUBOS.
                                &#160;<span id="projectnumber">0.1.0</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('cubinhos.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Cubinhos </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><em>Cubinhos</em> is the CLI tool used to work with <em>CUBOS.</em> At the moment, it contains the following commands:</p><ul>
<li><code>cubinhos help</code>: shows the help message;</li>
<li><code>cubinhos convert</code>: converts a <code>.qb</code> voxel file into the internal format used by CUBOS., <code>.grd</code> and <code>.pal</code>.</li>
<li><code>cubinhos embed</code>: utility used to embed files directly into an executable for use with the <code>EmbeddedArchive</code>.</li>
<li><code>cubinhos generate</code>: generates component definition boilerplate code.</li>
</ul>
<h1><a class="anchor" id="autotoc_md32"></a>
Convert</h1>
<p>The need for this tool arose from the fact that <b>CUBOS.</b> works with a single palette of voxel materials, and voxel objects refer to specific materials by their index in this palette. For example, if we had a single voxel red object, the red color wouldn't be specified in the voxel object. Instead, this object would specify that its material is <code>1</code>, and the palette would specify that the material <code>1</code> is red.</p>
<p>The issue is, voxel formats like <code>.qb</code> and <code>.vox</code> are not designed to store only the indices of materials, but the whole material definition, per voxel. This conflicts with the way <b>CUBOS.</b> works, so we need to convert these formats into the internal format used by <b>CUBOS.</b>. This is where <code>cubinhos convert</code> comes in. It takes a <code>.qb</code> voxel file and splits it into a palette (<code>.pal</code>), and one or more voxel grids (<code>.grd</code>).</p>
<h2><a class="anchor" id="autotoc_md33"></a>
Usage</h2>
<p>This guide will be based on four use cases:</p><ol type="1">
<li>loading a <code>.qb</code> file and creating a new <code>.pal</code>;</li>
<li>loading a <code>.qb</code> file and updating an existing <code>.pal</code>;</li>
<li>loading a <code>.qb</code> file and using, without editing, an existing <code>.pal</code>;</li>
<li>querying the contents of <code>.qb</code> model;</li>
</ol>
<h3><a class="anchor" id="autotoc_md34"></a>
Example 1: Creating a new palette</h3>
<p>This use case is most common when importing the first <code>.qb</code> file for a new project. There is no palette file yet, so we need to create one. Lets say the model we want to convert is a <code>car.qb</code>, which contains a single voxel object.</p>
<div class="fragment"><div class="line">$ cubinhos convert car.qb -p main.pal -g car.grd -w</div>
</div><!-- fragment --><p>First, we specify the <code>.qb</code> file to convert. Then, we specify the name of the palette we will be outputting. We also need to specify the output file for the voxel grid. Finally, we pass the <code>-w</code> flag which allows us to write to the palette file (which is necessary since there is none at the moment).</p>
<h3><a class="anchor" id="autotoc_md35"></a>
Example 2: Updating an existing palette</h3>
<p>Lets say we now want to import a <code>street.qb</code> model which contains two voxel grids: the first one is a road and the second one is a tree. Since we already have a palette, we want to add any new materials to it.</p>
<div class="fragment"><div class="line">$ cubinhos convert street.qb -p main.pal -g0 road.grd -g1 tree.grd -w</div>
</div><!-- fragment --><p>Once again, we first specify the <code>.qb</code> file to convert. Then, we specify the name of the palette we will be using, which is the same as the one we created in the previous example. This time, we have two grids in the <code>.qb</code> file, so we need to specify the output files for both. This is done by adding an index in front of <code>-g</code> (e.g. <code>-g0</code> for the first grid, <code>-g1</code> for the second). Finally, we once again pass the <code>-w</code> flag which allows the palette file to be updated.</p>
<h3><a class="anchor" id="autotoc_md36"></a>
Example 3: Using an existing palette</h3>
<p>What if we want to add another car model, but without adding materials to the palette? To do this, we will need to ommit the <code>-w</code> flag. This way, the palette will be read, and the most similar materials found will be used. By default, this will only succeed if the materials match exactly.</p>
<div class="fragment"><div class="line">$ cubinhos convert car2.qb -p main.pal -g car2.grd</div>
</div><!-- fragment --><p>If this fails, you may see the error message:</p>
<div class="fragment"><div class="line">Failed to convert grid 0 from its palette to the palette chosen.</div>
</div><!-- fragment --><p>One work around is lowering the threshold for material matching. If you want to allow for slightly different materials to be considered as the same, you can pass the <code>-s &lt;SIMILARITY&gt;</code> option. This value is a number from <code>0</code> to <code>1</code>, where <code>0</code> is completely different and <code>1</code> is completely the same. It represents the minimum similarity between two materials to consider them the same (default is <code>1</code>).</p>
<p>So, if the materials which aren't matching are very similar, you could add, for example, <code>-s 0.9</code> to the previous command. This way, the material chosen from the palette will have a similarity of at least <code>0.9</code> with the material in the original model.</p>
<h3><a class="anchor" id="autotoc_md37"></a>
Example 4: Querying the contents of a model</h3>
<p>You may want to check the contents of a <code>.qb</code> file before converting it. One easy way to do this is to use the <code>-v</code> (verbose) flag. This can be added to any of the previous commands to get extra information about what is going on.</p>
<p>It can also be used without any other options, in which case the program will just print the contents of the <code>.qb</code> file. For example:</p>
<div class="fragment"><div class="line">$ cubinhos convert car.qb -v</div>
<div class="line">Found 1 QB matrices.</div>
<div class="line">Matrix 0:</div>
<div class="line">- Position: -7 -5 -16</div>
<div class="line">- Grid size: 15x11x32</div>
<div class="line">- Palette size: 10</div>
</div><!-- fragment --><p>This tells us that the <code>car.qb</code> model contains exactly one voxel grid, that its position within the model is <code>(-7, -5, -16)</code>, that its size is <code>15x11x32</code>, and that it uses <code>10</code> different materials.</p>
<h1><a class="anchor" id="autotoc_md38"></a>
Embed</h1>
<p>The <code>cubinhos embed</code> tool is used to embed files directly into an executable for use with the <code>EmbeddedArchive</code>. This is useful for example when you want to ship a game with a set of assets, but don't want to have to distribute them as separate files. This way, you are able to ship a single executable file.</p>
<h2><a class="anchor" id="autotoc_md39"></a>
Usage</h2>
<p>This tool takes a file and generates a C++ source file which registers a new <code>EmbeddedArchive</code>, outputting it to the standard output. This source file can then be compiled and linked with your executable.</p>
<p>If no name for the archive is specified, the name of the file will be used. For example, if you run <code>cubinhos embed logo.png &gt; logo.cpp</code>, the name of the archive will be <code>logo.png</code>.</p>
<p>The resulting archive can then be mounted like this:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cubos/core/data/file_system.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cubos/core/data/embedded_archive.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">using namespace </span><a class="code" href="namespacecubos_1_1core_1_1data.html">cubos::core::data</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="classcubos_1_1core_1_1data_1_1FileSystem.html#a24316e70715c3ebe4e53e13f2d01f909">FileSystem::mount</a>(<span class="stringliteral">&quot;/logo.png&quot;</span>, std::make_shared&lt;EmbeddedArchive&gt;(<span class="stringliteral">&quot;logo.png&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>It's also possible to embed a whole directory, in which case you will need to use the <code>-r</code> flag. This will recursively embed all files in the directory.</p>
<p>Checkout the <code>embedded_archive</code> sample for a complete example.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
Generate</h1>
<p>For a type to be usable as a component, it must satisfy the following requirements:</p><ul>
<li>it must be (de)serializable, taking optionally some context necessary (such as the mapping between <code>Entity</code>s and their IDs, or a function to read or write handles).</li>
<li>it must define a storage type, which will then be used to store the component's data in the <code>World</code>.</li>
<li>it must call the <code>CUBOS_REGISTER_COMPONENT</code> macro, passing the ID of the component type, which associates the type with a unique ID.</li>
</ul>
<p>This means that, before <code>cubinhos generate</code>, component definitions looked like:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>MyComponent</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> x;</div>
<div class="line">    <span class="keywordtype">float</span> y;</div>
<div class="line">    std::string z;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The serialization functions must be defined in this namespace.</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespacecubos_1_1core_1_1data.html">cubos::core::data</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="namespacecubos_1_1core_1_1data.html#a97f36cce7ff37b16121110f7562a7d23">serialize</a>(Serializer&amp; s, <span class="keyword">const</span> MyComponent&amp; c, <span class="keyword">const</span> <span class="keywordtype">char</span>* name)</div>
<div class="line">    {</div>
<div class="line">        s.beginObject(name);</div>
<div class="line">        s.write(c.x);</div>
<div class="line">        s.write(c.y);</div>
<div class="line">        s.write(c.z);</div>
<div class="line">        s.endObject();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> deserialize(Deserializer&amp; d, MyComponent&amp; c)</div>
<div class="line">    {</div>
<div class="line">        d.beginObject();</div>
<div class="line">        d.read(c.x);</div>
<div class="line">        d.read(c.y);</div>
<div class="line">        d.read(c.z);</div>
<div class="line">        d.endObject();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The storage type must be defined in this namespace.</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespacecubos_1_1core_1_1ecs.html">cubos::core::ecs</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">template</span> &lt;&gt;</div>
<div class="line">    <span class="keyword">struct </span>ComponentStorage&lt;MyComponent&gt;</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">using</span> <a class="code" href="namespacecubos_1_1core_1_1gl.html#a1d1cfd8ffb84e947f82999c682b666a7">Type</a> = VecStorage&lt;MyComponent&gt;;</div>
<div class="line">    };</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">CUBOS_REGISTER_COMPONENT(MyComponent, <span class="stringliteral">&quot;my_component&quot;</span>);</div>
</div><!-- fragment --><p>This amount of boilerplate is not acceptable, specially for user-facing code. The <code>cubinhos generate</code> command makes use of a recent C++ feature called <a href="https://en.cppreference.com/w/cpp/language/attributes">attributes</a>. Attributes are usually used to provide hints to the compiler. However, on our case, we're using them to mark types as components.</p>
<p>With <code>cubinhos generate</code>, the same component definition can be written as:</p>
<div class="fragment"><div class="line"><span class="comment">// Must be included in the file where the component is defined.</span></div>
<div class="line"><span class="preprocessor">#include &lt;components/base.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>[[cubos::component(&quot;my_component&quot;, VecStorage)]] MyComponent</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> x;</div>
<div class="line">    <span class="keywordtype">float</span> y;</div>
<div class="line">    std::string z;</div>
<div class="line">};</div>
</div><!-- fragment --><p>This tool then searches for all types marked with the <code>cubos::component</code> and generates a header file for each one. In this case, a header file would be generated which could be included with <code>#include &lt;components/my_component.hpp&gt;</code>.</p>
<p>When using the component, the user must include the generated header file, and not the original one. Otherwise, the compiler won't see the generated code.</p>
<p>If the component is identified with a slash, as, for example, <code>game/my_component</code>, the generated header file will be placed in the <code>components/game</code> directory. This is useful for organizing components into different modules. For example, <code>cubos-engine</code> names all its components with the <code>cubos/</code> directory.</p>
<h2><a class="anchor" id="autotoc_md41"></a>
CMake</h2>
<p>This tool can be configured to run automatically when building the project. To do this, you can include the <code>CubinhosGenerate</code> module in your <code>CMakeLists.txt</code> and call the <code>cubinhos_generate</code> function with your target and the directory where the base component headers are located.</p>
<div class="fragment"><div class="line">include(CubinhosGenerate)</div>
<div class="line"> </div>
<div class="line">cubinhos_generate(my_target ${CMAKE_CURRENT_SOURCE_DIR}/components)</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="anamespacecubos_1_1core_1_1ecs_html"><div class="ttname"><a href="namespacecubos_1_1core_1_1ecs.html">cubos::core::ecs</a></div><div class="ttdoc">Contains the Entity-Component-System framework.</div><div class="ttdef"><b>Definition:</b> blueprint.hpp:10</div></div>
<div class="ttc" id="anamespacecubos_1_1core_1_1gl_html_a1d1cfd8ffb84e947f82999c682b666a7"><div class="ttname"><a href="namespacecubos_1_1core_1_1gl.html#a1d1cfd8ffb84e947f82999c682b666a7">cubos::core::gl::Type</a></div><div class="ttdeci">Type</div><div class="ttdoc">Data type.</div><div class="ttdef"><b>Definition:</b> render_device.hpp:83</div></div>
<div class="ttc" id="aclasscubos_1_1core_1_1data_1_1FileSystem_html_a24316e70715c3ebe4e53e13f2d01f909"><div class="ttname"><a href="classcubos_1_1core_1_1data_1_1FileSystem.html#a24316e70715c3ebe4e53e13f2d01f909">cubos::core::data::FileSystem::mount</a></div><div class="ttdeci">static void mount(std::string_view path, std::shared_ptr&lt; Archive &gt; archive)</div></div>
<div class="ttc" id="anamespacecubos_1_1core_1_1data_html_a97f36cce7ff37b16121110f7562a7d23"><div class="ttname"><a href="namespacecubos_1_1core_1_1data.html#a97f36cce7ff37b16121110f7562a7d23">cubos::core::data::serialize</a></div><div class="ttdeci">void serialize(Serializer &amp;serializer, const Package &amp;pkg, const char *name)</div></div>
<div class="ttc" id="anamespacecubos_1_1core_1_1data_html"><div class="ttname"><a href="namespacecubos_1_1core_1_1data.html">cubos::core::data</a></div><div class="ttdoc">Contains the virtual file and serialization systems, and other data related utilities.</div><div class="ttdef"><b>Definition:</b> archive.hpp:6</div></div>
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath">
  <!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="structure.html">Structure</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer"
          src="doxygen.svg" width="104" height="31" alt="doxygen" /></a> 1.8.17 </li>
  </ul>
</div>
<script type="text/javascript">
  $(function () {
    $(document).ready(function () {
      toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
      toggleButton.title = "Toggle Light/Dark Mode"
      document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
    })
  })
</script>
</body>
</html>